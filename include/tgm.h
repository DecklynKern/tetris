#include "main.h"

static const Point ars_minos[7][4][PIECE_MINO_COUNT] = {
    { // O
        {{ 0,  0}, { 1,  0}, { 0,  1}, { 1,  1}},
        {{ 0,  0}, { 1,  0}, { 0,  1}, { 1,  1}},
        {{ 0,  0}, { 1,  0}, { 0,  1}, { 1,  1}},
        {{ 0,  0}, { 1,  0}, { 0,  1}, { 1,  1}}
    },
    { // S
        {{ 0,  0}, { 1,  0}, {-1,  1}, { 0,  1}},
        {{-1, -1}, {-1,  0}, { 0,  0}, { 0,  1}},
        {{ 0,  0}, { 1,  0}, {-1,  1}, { 0,  1}},
        {{-1, -1}, {-1,  0}, { 0,  0}, { 0,  1}}
    },
    { // Z
        {{-1,  0}, { 0,  0}, { 0,  1}, { 1,  1}},
        {{ 1, -1}, { 0,  0}, { 1,  0}, { 0,  1}},
        {{-1,  0}, { 0,  0}, { 0,  1}, { 1,  1}},
        {{ 1, -1}, { 0,  0}, { 1,  0}, { 0,  1}}
    },
    { // L
        {{-1,  0}, { 0,  0}, { 1,  0}, {-1,  1}},
        {{ 0, -1}, { 0,  0}, { 0,  1}, { 1,  1}},
        {{ 1,  0}, {-1,  1}, { 0,  1}, { 1,  1}},
        {{-1, -1}, { 0, -1}, { 0,  0}, { 0,  1}}
    }, { // J
        {{-1,  0}, { 0,  0}, { 1,  0}, { 1,  1}},
        {{ 0, -1}, { 1, -1}, { 0,  0}, { 0,  1}},
        {{-1,  0}, {-1,  1}, { 0,  1}, { 1,  1}},
        {{ 0, -1}, { 0,  0}, {-1,  1}, { 0,  1}}
    },
    { // T
        {{-1,  0}, { 0,  0}, { 1,  0}, { 0,  1}},
        {{ 0, -1}, { 0,  0}, { 1,  0}, { 0,  1}},
        {{ 0,  0}, {-1,  1}, { 0,  1}, { 1,  1}},
        {{ 0, -1}, {-1,  0}, { 0,  0}, { 0,  1}}
    },
    { // I
        {{-1,  0}, { 0,  0}, { 1,  0}, { 2,  0}},
        {{ 1, -1}, { 1,  0}, { 1,  1}, { 1,  2}},
        {{-1,  0}, { 0,  0}, { 1,  0}, { 2,  0}},
        {{ 1, -1}, { 1,  0}, { 1,  1}, { 1,  2}}
    }
};

#define TGM1_NUM_GRAVITY_LEVELS 30
const struct {
    int level;
    int gravity;
} tgm1_gravity_table[TGM1_NUM_GRAVITY_LEVELS] = {
    {  0,    4},
    { 30,    6},
    { 35,    8},
    { 40,   10},
    { 50,   12},
    { 60,   16},
    { 70,   32},
    { 80,   48},
    { 90,   64},
    {100,   80},
    {120,   96},
    {140,  112},
    {160,  128},
    {170,  144},
    {200,    4},
    {220,   32},
    {230,   64},
    {233,   96},
    {236,  128},
    {239,  160},
    {243,  192},
    {247,  224},
    {251,  256},
    {300,  512},
    {330,  768},
    {360, 1024},
    {400, 1280},
    {420, 1024},
    {450,  768},
    {500, 5120},
};

#define NUM_GRADES 19
const struct {
    int score;
    char name[3];
} tgm1_grade_table[NUM_GRADES] = {
    {     0,  "9"},
    {   400,  "8"},
    {   800,  "7"},
    {  1400,  "6"},
    {  2000,  "5"},
    {  3500,  "4"},
    {  5500,  "3"},
    {  8000,  "2"},
    { 12000,  "1"},
    { 16000, "S1"},
    { 22000, "S2"},
    { 30000, "S3"},
    { 40000, "S4"},
    { 52000, "S5"},
    { 66000, "S6"},
    { 82000, "S7"},
    {100000, "S8"},
    {120000, "S9"},
    {126000, "GM"}
};

#define NUM_INTERNAL_GRADES 32
const struct {
    char displayed_grade[3];
    int decay_rate;
    int line_clear_values[4];
} grs_grade_table[NUM_INTERNAL_GRADES] = {
    { "9", 125, {10, 20, 40, 50}},
    { "8",  80, {10, 20, 30, 40}},
    { "7",  80, {10, 20, 30, 40}},
    { "6",  50, {10, 15, 30, 40}},
    { "5",  45, {10, 15, 20, 40}},
    { "4",  45, { 5, 15, 20, 30}},
    { "4",  45, { 5, 10, 20, 30}},
    { "3",  40, { 5, 10, 15, 30}},
    { "3",  40, { 5, 10, 15, 30}},
    { "2",  40, { 5, 10, 15, 30}},
    { "2",  40, { 2, 12, 13, 30}},
    { "2",  40, { 2, 12, 13, 30}},
    { "1",  30, { 2, 12, 13, 30}},
    { "1",  30, { 2, 12, 13, 30}},
    { "1",  30, { 2, 12, 13, 30}},
    {"S1",  20, { 2, 12, 13, 30}},
    {"S1",  20, { 2, 12, 13, 30}},
    {"S1",  20, { 2, 12, 13, 30}},
    {"S2",  20, { 2, 12, 13, 30}},
    {"S3",  20, { 2, 12, 13, 30}},
    {"S4",  15, { 2, 12, 13, 30}},
    {"S4",  15, { 2, 12, 13, 30}},
    {"S4",  15, { 2, 12, 13, 30}},
    {"S5",  15, { 2, 12, 13, 30}},
    {"S5",  15, { 2, 12, 13, 30}},
    {"S6",  15, { 2, 12, 13, 30}},
    {"S6",  15, { 2, 12, 13, 30}},
    {"S7",  15, { 2, 12, 13, 30}},
    {"S7",  15, { 2, 12, 13, 30}},
    {"S8",  15, { 2, 12, 13, 30}},
    {"S8",  10, { 2, 12, 13, 30}},
    {"S9",  10, { 2, 12, 13, 30}}
};

#define MAX_COMBO 10
const float grs_combo_table[MAX_COMBO][4] = {
    {1.0, 1.0, 1.0, 1.0},
    {1.2, 1.4, 1.5, 1.0},
    {1.2, 1.5, 1.8, 1.0},
    {1.4, 1.6, 2.0, 1.0},
    {1.4, 1.7, 2.2, 1.0},
    {1.4, 1.8, 2.3, 1.0},
    {1.4, 1.8, 2.4, 1.0},
    {1.5, 1.9, 2.5, 1.0},
    {1.5, 2.0, 2.6, 1.0},
    {2.0, 2.5, 3.0, 1.0}
};

// TODO: implement line ARE
#define TAP_NUM_SPEED_LEVELS 6
const struct {
    int level;
    int are_delay;
    int das_delay;
    int lock_delay;
    int line_clear_delay;
} tap_master_speed_table[TAP_NUM_SPEED_LEVELS] = {
    {  0, 27, 16, 30, 40},
    {500, 27, 10, 30, 25},
    {601, 27, 10, 30,  7},
    {701, 18, 10, 30,  8},
    {801, 14, 10, 30,  0},
    {901, 14,  8, 17,  0}
};

#define TGMPLUS_NUM_GARBAGE_ROWS 24
const int tgmplus_garbage_rows[TGMPLUS_NUM_GARBAGE_ROWS][BOARD_WIDTH] = {
    {0, 1, 1, 1, 1, 1, 1, 1, 1, 1},
    {0, 1, 1, 1, 1, 1, 1, 1, 1, 1},
    {0, 1, 1, 1, 1, 1, 1, 1, 1, 1},
    {0, 1, 1, 1, 1, 1, 1, 1, 1, 1},
    {1, 1, 1, 1, 1, 1, 1, 1, 1, 0},
    {1, 1, 1, 1, 1, 1, 1, 1, 1, 0},
    {1, 1, 1, 1, 1, 1, 1, 1, 1, 0},
    {1, 1, 1, 1, 1, 1, 1, 1, 1, 0},
    {0, 0, 1, 1, 1, 1, 1, 1, 1, 1},
    {0, 1, 1, 1, 1, 1, 1, 1, 1, 1},
    {0, 1, 1, 1, 1, 1, 1, 1, 1, 1},
    {1, 1, 1, 1, 1, 1, 1, 1, 0, 0},
    {1, 1, 1, 1, 1, 1, 1, 1, 1, 0},
    {1, 1, 1, 1, 1, 1, 1, 1, 1, 0},
    {1, 1, 0, 1, 1, 1, 1, 1, 1, 1},
    {1, 0, 0, 1, 1, 1, 1, 1, 1, 1},
    {1, 0, 1, 1, 1, 1, 1, 1, 1, 1},
    {1, 1, 1, 1, 1, 1, 1, 0, 1, 1},
    {1, 1, 1, 1, 1, 1, 1, 0, 0, 1},
    {1, 1, 1, 1, 1, 1, 1, 1, 0, 1},
    {1, 1, 1, 1, 0, 0, 1, 1, 1, 1},
    {1, 1, 1, 1, 0, 0, 1, 1, 1, 1},
    {1, 1, 1, 1, 0, 1, 1, 1, 1, 1},
    {1, 1, 1, 0, 0, 0, 1, 1, 1, 1},
};

const struct {
    int level;
    int are_delay;
    int das_delay;
    int lock_delay;
    int line_clear_delay;
} tap_death_speed_table[TAP_NUM_SPEED_LEVELS] = {
    {  0, 18, 12, 30,  8},
    {100, 14, 12, 26,  0},
    {200, 14, 11, 22,  0},
    {300,  8, 10, 18,  6},
    {400,  7,  8, 15,  5},
    {500,  6,  8, 15,  4}
};